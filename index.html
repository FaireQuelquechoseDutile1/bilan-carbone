<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bilan Carbone</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; margin:20px; background:#f5f5f5; color:#222; }
.dark-mode { background:#121212; color:#eee; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; }
th,td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#eee; }
.dark-mode th { background:#222; }
input[type="number"]{ width:60px; }
button,select{ margin-right:10px; margin-bottom:10px; }
#co2Chart{ width:100%; height:400px; }
</style>
</head>
<body>

<h1 data-key="title">Bilan Carbone</h1>

<div>
<label data-key="lang">Langue :</label>
<select id="languageSelect" onchange="changeLanguage()">
<option value="fr">Français</option>
<option value="en">English</option>
</select>

<label data-key="dark">Mode sombre :</label>
<input type="checkbox" id="darkModeSwitch" onchange="toggleDarkMode()">

<button onclick="exportCSV()" data-key="export_csv">Exporter CSV</button>
<button onclick="exportJSON()" data-key="export_json">Exporter JSON</button>
</div>

<table id="transportTable">
<thead>
<tr>
<th data-key="transport">Transport</th>
<th data-key="distance">Distance (km)</th>
<th data-key="usage">Usage² (kg CO₂)</th>
<th data-key="construction">Construction (kg CO₂)</th>
</tr>
</thead>
<tbody>
<tr data-key="tgv"><td>TGV</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>45</td></tr>
<tr data-key="intercite"><td>Intercité</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>60</td></tr>
<tr data-key="rer_transilien"><td>RER/Transilien</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>50</td></tr>
<tr data-key="autocar_thermique"><td>Autocar thermique</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>40</td></tr>
<tr data-key="covoiturage_elec"><td>Covoiturage électrique</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>10</td></tr>
<tr data-key="covoiturage_thermique"><td>Covoiturage thermique</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>15</td></tr>
<tr data-key="moto_thermique"><td>Moto thermique</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>80</td></tr>
<tr data-key="scooter_thermique"><td>Scooter/moto légère thermique</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>30</td></tr>
<tr data-key="avion_court"><td>Avion court courrier</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>120</td></tr>
<tr data-key="avion_long"><td>Avion long courrier</td><td><input type="number" onchange="updateTable()"></td><td>0</td><td>300</td></tr>
</tbody>
<tfoot>
<tr>
<th colspan="2" data-key="total">Total</th>
<th id="totalUsage">0</th>
<th id="totalConstruction">0</th>
</tr>
</tfoot>
</table>

<canvas id="co2Chart"></canvas>

<script>
const factors={
tgv:0.041, intercite:0.041, rer_transilien:0.041, autocar_thermique:0.104,
covoiturage_elec:0.01, covoiturage_thermique:0.171, moto_thermique:0.12,
scooter_thermique:0.09, avion_court:0.255, avion_long:0.255
};

const translations={
fr:{
title:"Bilan Carbone",lang:"Langue :",dark:"Mode sombre :",
export_csv:"Exporter CSV",export_json:"Exporter JSON",transport:"Transport",
distance:"Distance (km)",usage:"Usage² (kg CO₂)",construction:"Construction (kg CO₂)",
total:"Total",tgv:"TGV",intercite:"Intercité",rer_transilien:"RER/Transilien",
autocar_thermique:"Autocar thermique",covoiturage_elec:"Covoiturage électrique",
covoiturage_thermique:"Covoiturage thermique",moto_thermique:"Moto thermique",
scooter_thermique:"Scooter/moto légère thermique",avion_court:"Avion court courrier",
avion_long:"Avion long courrier"
},
en:{
title:"Carbon Footprint",lang:"Language:",dark:"Dark Mode:",
export_csv:"Export CSV",export_json:"Export JSON",transport:"Transport",
distance:"Distance (km)",usage:"Usage² (kg CO₂)",construction:"Construction (kg CO₂)",
total:"Total",tgv:"TGV",intercite:"Intercity",rer_transilien:"RER/Transilien",
autocar_thermique:"Thermal coach",covoiturage_elec:"Electric carpool",
covoiturage_thermique:"Thermal carpool",moto_thermique:"Thermal motorcycle",
scooter_thermique:"Thermal scooter/motorbike",avion_court:"Short-haul plane",
avion_long:"Long-haul plane"
}
};

let co2Chart=null;

function updateTable(){
let totalUsage=0,totalConstruction=0;
const labels=[],data=[];
const lang=document.getElementById('languageSelect').value;
document.querySelectorAll("#transportTable tbody tr").forEach(row=>{
const key=row.getAttribute("data-key");
const input=row.cells[1].getElementsByTagName("input")[0].value;
let usage=0;
if(input){usage=parseFloat(input)*factors[key]; row.cells[2].innerText=usage.toFixed(2);}
else row.cells[2].innerText='0';
totalUsage+=usage;
totalConstruction+=parseFloat(row.cells[3].innerText);
if(input && usage>0){labels.push(translations[lang][key]); data.push(usage);}
});
document.getElementById('totalUsage').innerText=totalUsage.toFixed(2);
document.getElementById('totalConstruction').innerText=totalConstruction.toFixed(2);
updateChart(labels,data);
saveLocal();
}

function updateChart(labels,data){
if(co2Chart) co2Chart.destroy();
const ctx=document.getElementById('co2Chart').getContext('2d');
co2Chart=new Chart(ctx,{
type:'bar',
data:{labels,datasets:[{label:'kg CO₂', data, backgroundColor:'rgba(75,192,192,0.6)'}]},
options:{responsive:true, maintainAspectRatio:false, scales:{y:{beginAtZero:true}}}
});
}

function changeLanguage(){
const lang=document.getElementById('languageSelect').value;
document.querySelectorAll("[data-key]").forEach(el=>{
const key=el.getAttribute("data-key");
if(translations[lang][key]) el.innerText=translations[lang][key];
});
updateTable();
}

function toggleDarkMode(){document.body.classList.toggle('dark-mode');}

function exportCSV(){
let csv='Transport,Distance (km),Usage² (kg CO₂),Construction (kg CO₂)\n';
document.querySelectorAll("#transportTable tbody tr").forEach(row=>{
const input=row.cells[1].getElementsByTagName("input")[0].value;
if(input) csv+=`"${row.cells[0].innerText}",${input},${row.cells[2].innerText},${row.cells[3].innerText}\n`;
});
const blob=new Blob([csv],{type:'text/csv'}),url=URL.createObjectURL(blob);
const a=document.createElement('a'); a.href=url; a.download='bilan_carbone.csv'; a.click(); URL.revokeObjectURL(url);
}

function exportJSON(){
const data=[];
document.querySelectorAll("#transportTable tbody tr").forEach(row=>{
const input=row.cells[1].getElementsByTagName("input")[0].value;
if(input) data.push({
transport:row.cells[0].innerText,
distance_km:input,
usage_kgCO2:row.cells[2].innerText,
construction_kgCO2:row.cells[3].innerText
});
});
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'}),url=URL.createObjectURL(blob);
const a=document.createElement('a'); a.href=url; a.download='bilan_carbone.json'; a.click(); URL.revokeObjectURL(url);
}

function saveLocal(){
const obj={};
document.querySelectorAll("#transportTable tbody tr").forEach(row=>{
const input=row.cells[1].getElementsByTagName("input")[0].value;
if(input) obj[row.getAttribute("data-key")]=input;
});
localStorage.setItem('bilanData',JSON.stringify(obj));
}

function loadLocal(){
const obj=JSON.parse(localStorage.getItem('bilanData')||'{}');
document.querySelectorAll("#transportTable tbody tr").forEach(row=>{
const key=row.getAttribute("data-key");
if(obj[key]) row.cells[1].getElementsByTagName("input")[0].value=obj[key];
});
updateTable();
}

window.onload=loadLocal;
</script>

</body>
</html>
