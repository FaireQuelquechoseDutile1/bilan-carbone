<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bilan Carbone</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; color: #333; }
.dark-mode { background-color: #1e1e1e; color: #f5f5f5; }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background-color: #eee; }
.dark-mode th { background-color: #333; }
input[type="number"] { width: 80px; }
button { margin: 5px; }
#chartContainer { width: 100%; max-width: 800px; margin: auto; height: 400px; }
</style>
</head>
<body>

<h1 id="pageTitle">Bilan Carbone</h1>

<label for="languageSelect" id="labelLang">Langue :</label>
<select id="languageSelect" onchange="changeLanguage(this.value)">
    <option value="fr">Français</option>
    <option value="en">English</option>
</select>

<label for="darkSwitch" id="labelDark">Mode sombre :</label>
<input type="checkbox" id="darkSwitch" onchange="toggleDarkMode(this.checked)">


<table id="transportTable">
<thead>
<tr>
    <th id="colTransport">Transport</th>
    <th id="colCoeff">Coefficient d'usage</th>
    <th id="colDistance">Distance (km)</th>
    <th id="colUsage">Usage² (kg CO₂)</th>
    <th id="colConstruction">Construction (kg CO₂)</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
    <th>Total</th><th></th><th></th><th id="totalUsage">0</th><th id="totalConstruction">0</th>
</tr>
</tfoot>
</table>

<button id="exportCSVBtn" onclick="exportCSV()">Exporter CSV</button>
<button id="exportJSONBtn" onclick="exportJSON()">Exporter JSON</button>
<button id="resetCoeffBtn" onclick="resetCoefficients()">Réinitialiser les coefficients</button>
<button id="resetDistBtn" onclick="resetDistances()">Réinitialiser la distance</button>
<button id="toggleConstructionBtn" onclick="toggleConstruction()">Afficher/Masquer Construction</button>

<div id="chartContainer">
    <canvas id="co2Chart"></canvas>
</div>

<script type="text/javascript">
// --- Données des transports ---
const transports = {
    'voiture_essence': {name: 'Voiture essence', factor: 0.192, construction: 500},
    'voiture_diesel': {name: 'Voiture diesel', factor: 0.171, construction: 520},
    'tgv': {name: 'TGV', factor: 0.08, construction: 50},
    'intercite': {name: 'Intercité', factor: 0.07, construction: 45},
    'rer_transilien': {name: 'RER/Transilien', factor: 0.05, construction: 30},
    'autocar_thermique': {name: 'Autocar thermique', factor: 0.1, construction: 40},
    'covoiturage_electrique': {name: 'Covoiturage électrique', factor: 0.02, construction: 50},
    'covoiturage_thermique': {name: 'Covoiturage thermique', factor: 0.1, construction: 500},
    'moto_thermique': {name: 'Moto thermique', factor: 0.12, construction: 30},
    'scooter_thermique': {name: 'Scooter ou moto légère thermique', factor: 0.08, construction: 20},
    'avion_court': {name: 'Avion court-courrier', factor: 0.255, construction: 150},
    'avion_long': {name: 'Avion long-courrier', factor: 0.195, construction: 250},
    'velo': {name: 'Vélo', factor: 0, construction: 10},
    'velo_electrique': {name: 'Vélo électrique', factor: 0.01, construction: 20},
    'trottinette': {name: 'Trottinette', factor: 0, construction: 5},
    'trottinette_electrique': {name: 'Trottinette électrique', factor: 0.01, construction: 15},
    'tram': {name: 'Tram', factor: 0.03, construction: 30}
};

// --- Traductions ---
const translations = {
    en: {
        pageTitle: "Carbon Footprint",
        colTransport: "Transport",
        colCoeff: "Usage coefficient",
        colDistance: "Distance (km)",
        colUsage: "Usage² (kg CO₂)",
        colConstruction: "Construction (kg CO₂)",
        'Voiture essence':'Gasoline car', 'Voiture diesel':'Diesel car', 'TGV':'TGV',
        'Intercité':'Intercity', 'RER/Transilien':'RER/Commuter train', 'Autocar thermique':'Thermal bus',
        'Covoiturage électrique':'Electric carpool', 'Covoiturage thermique':'Thermal carpool',
        'Moto thermique':'Thermal motorcycle', 'Scooter ou moto légère thermique':'Thermal scooter/light motorcycle',
        'Avion court-courrier':'Short-haul plane', 'Avion long-courrier':'Long-haul plane',
        'Vélo':'Bike', 'Vélo électrique':'Electric bike', 'Trottinette':'Scooter', 'Trottinette électrique':'Electric scooter', 'Tram':'Tram',
        'Exporter CSV':'Export CSV', 'Exporter JSON':'Export JSON',
        'Réinitialiser les coefficients':'Reset coefficients', 'Réinitialiser la distance':'Reset distances',
        'Afficher/Masquer Construction':'Show/Hide Construction',
        'Langue :':'Language:', 'Mode sombre :':'Dark mode:'
    },
    fr: {} // français par défaut
};


// --- Génération du tableau ---
function generateTable() {
    const tbody = document.querySelector('#transportTable tbody');
    tbody.innerHTML = '';
    for (const key in transports) {
        const tr = document.createElement('tr');
        tr.dataset.key = key;
        tr.innerHTML = `
            <td>${transports[key].name}</td>
            <td><input type="number" step="0.01" value="${transports[key].factor}" onchange="updateTable()"></td>
            <td><input type="number" value="0" onchange="updateTable()"></td>
            <td>0</td>
            <td>${transports[key].construction}</td>
        `;
        tbody.appendChild(tr);
    }
}

// --- Construction toggle ---
let showConstruction = true;
function toggleConstruction() {
    showConstruction = !showConstruction;
    updateTable();
}

// --- Mise à jour du tableau et graphique ---
let co2Chart;
function updateTable() {
    let totalUsage = 0, totalConstruction = 0;
    const tbody = document.querySelector('#transportTable tbody');
    const chartLabels = [], chartUsage = [], chartConstruction = [];

    tbody.querySelectorAll('tr').forEach(row => {
        const coeff = parseFloat(row.cells[1].querySelector('input').value) || 0;
        const distance = parseFloat(row.cells[2].querySelector('input').value) || 0;
        const usage = coeff * distance;
        row.cells[3].textContent = usage.toFixed(2);
        totalUsage += usage;

        const construction = parseFloat(row.cells[4].textContent) || 0;
        if(distance > 0) totalConstruction += construction;

        if(distance > 0) {
            chartLabels.push(row.cells[0].textContent);
            chartUsage.push(usage);
            chartConstruction.push(construction);
        }
    });

    document.getElementById('totalUsage').textContent = totalUsage.toFixed(2);
    document.getElementById('totalConstruction').textContent = totalConstruction.toFixed(2);

    const ctx = document.getElementById('co2Chart').getContext('2d');
    if(co2Chart) co2Chart.destroy();
    co2Chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: chartLabels,
            datasets: [
                {label: translations[document.getElementById('languageSelect').value].colUsage || 'Usage', data: chartUsage, backgroundColor: 'rgba(75, 192, 192, 0.7)'},
                {label: translations[document.getElementById('languageSelect').value].colConstruction || 'Construction', data: chartConstruction, backgroundColor: 'rgba(192, 75, 192, 0.7)', hidden: !showConstruction}
            ]
        },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });
}

// --- Export CSV et JSON ---
function exportCSV() {
    let csv = "Transport,Coefficient,Distance,Usage,Construction\n";
    document.querySelectorAll('#transportTable tbody tr').forEach(row => {
        const rowData = Array.from(row.cells).map(cell => cell.textContent);
        csv += rowData.join(',') + "\n";
    });
    const blob = new Blob([csv], {type: 'text/csv'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'bilan_carbone.csv';
    link.click();
}

function exportJSON() {
    const data = {};
    document.querySelectorAll('#transportTable tbody tr').forEach(row => {
        const key = row.dataset.key;
        data[key] = {
            name: row.cells[0].textContent,
            coefficient: parseFloat(row.cells[1].querySelector('input').value) || 0,
            distance: parseFloat(row.cells[2].querySelector('input').value) || 0,
            usage: parseFloat(row.cells[3].textContent) || 0,
            construction: parseFloat(row.cells[4].textContent) || 0
        };
    });
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'bilan_carbone.json';
    link.click();
}

// --- Réinitialisations ---
function resetCoefficients() {
    document.querySelectorAll('#transportTable tbody tr').forEach(row => {
        const key = row.dataset.key;
        row.cells[1].querySelector('input').value = transports[key].factor;
    });
    updateTable();
}
function resetDistances() {
    document.querySelectorAll('#transportTable tbody tr').forEach(row => row.cells[2].querySelector('input').value = 0);
    updateTable();
}

// --- Dark mode ---
function toggleDarkMode(checked) {
    document.body.classList.toggle('dark-mode', checked);
}

// --- Changement de langue ---
function changeLanguage(lang) {
    document.getElementById('pageTitle').textContent = translations[lang].pageTitle || 'Bilan Carbone';
    document.getElementById('colTransport').textContent = translations[lang].colTransport || 'Transport';
    document.getElementById('colCoeff').textContent = translations[lang].colCoeff || 'Coefficient d\'usage';
    document.getElementById('colDistance').textContent = translations[lang].colDistance || 'Distance (km)';
    document.getElementById('colUsage').textContent = translations[lang].colUsage || 'Usage² (kg CO₂)';
    document.getElementById('colConstruction').textContent = translations[lang].colConstruction || 'Construction (kg CO₂)';
	document.getElementById('labelLang').textContent = translations[lang]['Langue :'] || 'Langue :';
	document.getElementById('labelDark').textContent = translations[lang]['Mode sombre :'] || 'Mode sombre :';

    document.querySelectorAll('#transportTable tbody tr').forEach(row => {
        const key = row.dataset.key;
        row.cells[0].textContent = translations[lang][transports[key].name] || transports[key].name;
    });

    document.getElementById('exportCSVBtn').textContent = translations[lang]['Exporter CSV'] || 'Exporter CSV';
    document.getElementById('exportJSONBtn').textContent = translations[lang]['Exporter JSON'] || 'Exporter JSON';
    document.getElementById('resetCoeffBtn').textContent = translations[lang]['Réinitialiser les coefficients'] || 'Réinitialiser les coefficients';
    document.getElementById('resetDistBtn').textContent = translations[lang]['Réinitialiser la distance'] || 'Réinitialiser la distance';
    document.getElementById('toggleConstructionBtn').textContent = translations[lang]['Afficher/Masquer Construction'] || 'Afficher/Masquer Construction';

    updateTable();
}

// --- Initialisation ---
generateTable();
updateTable();
</script>

</body>
</html>
